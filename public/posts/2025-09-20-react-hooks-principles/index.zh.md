---
title: "Hook åŸç†ä¸æœºåˆ¶è¯¦è§£"
date: "2025-09-20"
tags: ["React", "Hooks", "åŸç†", "é¢è¯•"]
category: "æŠ€æœ¯æ•™ç¨‹"
author: "åšä¸»"
excerpt: "æ·±å…¥è®²è§£ React Hooks çš„è®¾è®¡æ€æƒ³ã€é“¾è¡¨å­˜å‚¨æœºåˆ¶ã€useState/useEffect åŸç†ã€æ‰§è¡Œæ—¶æœºã€æ€§èƒ½ä¼˜åŒ– Hookï¼Œä»¥åŠå¸¸è§é¢è¯•é—®é¢˜å’Œè‡ªå®šä¹‰ Hook å®æˆ˜ã€‚"
---

# ğŸ§© ç¬¬ 3 ç« ï¼šHook åŸç†ä¸æœºåˆ¶ï¼ˆå®æˆ˜ + é¢è¯•ç‰ˆï¼‰

## ä¸€ã€ä¸ºä»€ä¹ˆä¼šå‡ºç° Hookï¼Ÿ

### âœ… èƒŒæ™¯é—®é¢˜

React 16.8 ä»¥å‰ï¼Œç»„ä»¶åˆ†ä¸¤ç§ï¼š
- **ç±»ç»„ä»¶ï¼ˆClass Componentï¼‰**ï¼šå¯ä»¥ä½¿ç”¨ state å’Œç”Ÿå‘½å‘¨æœŸï¼›
- **å‡½æ•°ç»„ä»¶ï¼ˆFunctional Componentï¼‰**ï¼šåªèƒ½æ¥æ”¶ propsï¼Œæ²¡æœ‰çŠ¶æ€ã€‚

è¿™å¯¼è‡´ä¸¤ä¸ªé—®é¢˜ï¼š

1. **é€»è¾‘å¤ç”¨å›°éš¾**
   - ä¸åŒç»„ä»¶æƒ³å¤ç”¨çŠ¶æ€é€»è¾‘ï¼Œåªèƒ½ç”¨ HOC æˆ– Render Propsï¼›
   - å¯¼è‡´"åµŒå¥—åœ°ç‹±"ã€‚

2. **ç±»ç»„ä»¶å¤ªå¤æ‚**
   - this æŒ‡å‘å®¹æ˜“å‡ºé”™ï¼›
   - ç”Ÿå‘½å‘¨æœŸéš¾ä»¥ç»´æŠ¤ã€‚

---

### ğŸš€ Hook çš„å‡ºç°
Hook çš„è®¾è®¡ç›®æ ‡æ˜¯ï¼š
> "åœ¨å‡½æ•°ç»„ä»¶ä¸­ä½¿ç”¨çŠ¶æ€ã€ç”Ÿå‘½å‘¨æœŸå’Œå‰¯ä½œç”¨é€»è¾‘ã€‚"

å› æ­¤ React æä¾›äº†ä¸€ç³»åˆ—å†…ç½® Hookï¼Œæ¯”å¦‚ï¼š
- `useState` â€”â€” ç®¡ç†çŠ¶æ€ï¼›
- `useEffect` â€”â€” å‰¯ä½œç”¨ï¼›
- `useMemo` / `useCallback` â€”â€” æ€§èƒ½ä¼˜åŒ–ï¼›
- `useRef` â€”â€” å¼•ç”¨ DOM æˆ–ä¿å­˜å¯å˜å€¼ï¼›
- `useContext` / `useReducer` â€”â€” çŠ¶æ€ç®¡ç†ã€‚

---

## äºŒã€Hook çš„æ ¸å¿ƒè®¾è®¡æ€æƒ³

Hook çš„æœ¬è´¨æ˜¯ä¸€ä¸ª"çŠ¶æ€è®°å¿†æœºåˆ¶"ã€‚
React å†…éƒ¨ä¼šä¸ºæ¯ä¸ªç»„ä»¶ç»´æŠ¤ä¸€æ¡ **Hook é“¾è¡¨ï¼ˆLinked Listï¼‰**ã€‚

> æ¯æ¬¡ç»„ä»¶æ‰§è¡Œæ—¶ï¼ŒReact æŒ‰ç…§ Hook è°ƒç”¨çš„é¡ºåºï¼Œä¾æ¬¡å–å‡ºä¸Šä¸€æ¬¡ä¿å­˜çš„çŠ¶æ€ã€‚

---

### ğŸ§© ä¼ªä»£ç ç¤ºä¾‹

```js
let workInProgressHook = fiber.memoizedState;

function useState(initialState) {
  const hook = workInProgressHook || { memoizedState: initialState };
  const setState = newState => {
    hook.memoizedState = newState;
    scheduleUpdateOnFiber(fiber);
  };
  workInProgressHook = hook.next;
  return [hook.memoizedState, setState];
}
```

ğŸ” å¯ä»¥çœ‹å‡ºï¼š
- æ¯è°ƒç”¨ä¸€æ¬¡ `useState`ï¼ŒReact å°±åœ¨ Hook é“¾è¡¨ä¸Šåˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹ï¼›
- é€šè¿‡ã€Œè°ƒç”¨é¡ºåºã€è¯†åˆ«æ¯ä¸ª Hook å¯¹åº”çš„çŠ¶æ€ï¼›
- `setState` æ›´æ–°çŠ¶æ€å¹¶è§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚

---

## ä¸‰ã€Hook é“¾è¡¨ç»“æ„ï¼ˆå›¾è§£æè¿°ï¼‰

```
FiberNode(App)
   â””â”€â”€ memoizedState â†’ Hook1(useState)
                         â†“
                         Hook2(useEffect)
                         â†“
                         Hook3(useMemo)
```

æ¯æ¬¡å‡½æ•°ç»„ä»¶æ‰§è¡Œæ—¶ï¼š
1. React ä¼šä»å¤´éå† Hook é“¾è¡¨ï¼›
2. æŒ‰ç›¸åŒé¡ºåºè°ƒç”¨æ¯ä¸ª Hookï¼›
3. å¦‚æœ Hook é¡ºåºä¸åŒï¼ˆä¾‹å¦‚æ”¾åœ¨ if é‡Œï¼‰ï¼ŒçŠ¶æ€ä¼šé”™ä½ã€‚

---

## å››ã€useState åŸç†è¯¦è§£

### âœ… ä½œç”¨
åœ¨å‡½æ•°ç»„ä»¶ä¸­å£°æ˜ä¸€ä¸ªå“åº”å¼çŠ¶æ€å˜é‡ã€‚

```jsx
const [count, setCount] = useState(0);
```

### ğŸ” åŸç†
React åœ¨ fiber.memoizedState ä¸­ä¿å­˜æ¯ä¸ª Hook çš„çŠ¶æ€ã€‚
- `count` ä¿å­˜å½“å‰çŠ¶æ€ï¼›
- `setCount` è§¦å‘æ›´æ–°ï¼›
- æ¯æ¬¡ render æ—¶æŒ‰è°ƒç”¨é¡ºåºå–å€¼ã€‚

### âš ï¸ æ³¨æ„äº‹é¡¹
- `setCount` æ˜¯å¼‚æ­¥æ‰¹å¤„ç†ï¼›
- æ–°æ—§ state ç›¸åŒæ—¶ä¸ä¼šè§¦å‘æ¸²æŸ“ï¼›
- å‡½æ•°å¼æ›´æ–° `setCount(c => c + 1)` å¯ä»¥ä¿è¯æ‹¿åˆ°æœ€æ–°å€¼ã€‚

---

### ğŸ’¡ ç¤ºä¾‹ï¼šå¤šæ¬¡ setState åªæ¸²æŸ“ä¸€æ¬¡
```jsx
function Counter() {
  const [count, setCount] = useState(0);

  const handleClick = () => {
    setCount(c => c + 1);
    setCount(c => c + 1);
    setCount(c => c + 1);
  };

  console.log("render:", count);
  return <button onClick={handleClick}>{count}</button>;
}
```

ç»“æœï¼š
- æ§åˆ¶å°æ‰“å°ä¸€æ¬¡ï¼›
- æœ€ç»ˆ count = 3ï¼›
- å› ä¸º React ä¼šæ‰¹é‡å¤„ç†åŒä¸€äº‹ä»¶å†…çš„æ‰€æœ‰æ›´æ–°ã€‚

---

## äº”ã€useEffect åŸç†ä¸æ‰§è¡Œæ—¶æœº

### âœ… åŸºæœ¬ä½œç”¨
åœ¨å‡½æ•°ç»„ä»¶ä¸­æ‰§è¡Œå‰¯ä½œç”¨é€»è¾‘ï¼ˆå¦‚ DOM æ“ä½œã€æ•°æ®è¯·æ±‚ã€è®¢é˜…ç­‰ï¼‰ã€‚

```jsx
useEffect(() => {
  console.log("ç»„ä»¶æ¸²æŸ“æˆ–ä¾èµ–å˜åŒ–");
  return () => console.log("ç»„ä»¶å¸è½½æˆ–ä¾èµ–æ›´æ–°å‰");
}, [count]);
```

---

### ğŸ§© æ‰§è¡Œæ—¶æœºï¼ˆéå¸¸é‡è¦ï¼‰

| Hook | æ‰§è¡Œæ—¶æœº | æ˜¯å¦é˜»å¡æ¸²æŸ“ | å…¸å‹ç”¨é€” |
|------|------------|----------------|------------|
| `useEffect` | æµè§ˆå™¨ç»˜åˆ¶åæ‰§è¡Œï¼ˆå¼‚æ­¥ï¼‰ | âŒ å¦ | ç½‘ç»œè¯·æ±‚ã€äº‹ä»¶ç»‘å®š |
| `useLayoutEffect` | DOM æ›´æ–°åã€ç»˜åˆ¶å‰æ‰§è¡Œï¼ˆåŒæ­¥ï¼‰ | âœ… æ˜¯ | è®¡ç®—å¸ƒå±€ã€åŠ¨ç”» |

---

### ğŸ” React å†…éƒ¨å¤„ç†æµç¨‹

```js
const effect = {
  create,          // å‰¯ä½œç”¨å‡½æ•°
  deps,            // ä¾èµ–æ•°ç»„
  destroy,         // æ¸…ç†å‡½æ•°
  next             // æŒ‡å‘ä¸‹ä¸€ä¸ª effect
};
fiber.updateQueue.lastEffect.next = effect;
```

æ¸²æŸ“ç»“æŸåï¼ŒReact ä¼šåœ¨ **commit é˜¶æ®µ** æ‰§è¡Œæ‰€æœ‰ `useEffect`ã€‚

---

### âš ï¸ å¸¸è§é™·é˜±

1ï¸âƒ£ å¿˜è®°åŠ ä¾èµ–æ•°ç»„ï¼ˆæ­»å¾ªç¯æ¸²æŸ“ï¼‰
```js
useEffect(() => {
  setCount(count + 1);
});
```

2ï¸âƒ£ åŠ äº†é”™è¯¯çš„ä¾èµ–ï¼ˆä¸ç¨³å®šå‡½æ•°ï¼‰
```js
useEffect(() => { ... }, [props.onChange]);
```
è§£å†³ï¼šç”¨ `useCallback` ç¨³å®šå‡½æ•°å¼•ç”¨ã€‚

---

## å…­ã€useMemo ä¸ useCallback åŸç†

### âœ… useMemo
ç¼“å­˜è®¡ç®—ç»“æœï¼Œé¿å…é‡å¤æ‰§è¡Œé«˜å¼€é”€é€»è¾‘ã€‚
```jsx
const value = useMemo(() => expensiveCalculation(a, b), [a, b]);
```
åŸç†ï¼šReact è®°å½•ä¸Šä¸€æ¬¡ä¾èµ–æ•°ç»„ `[a, b]`ï¼Œè‹¥æ²¡å˜åŒ–åˆ™å¤ç”¨æ—§å€¼ã€‚

---

### âœ… useCallback
ç¼“å­˜å‡½æ•°å¼•ç”¨ï¼Œé˜²æ­¢å­ç»„ä»¶ä¸å¿…è¦é‡æ¸²æŸ“ã€‚
```jsx
const handleClick = useCallback(() => doSomething(id), [id]);
```
ç›¸å½“äºï¼š
```js
useMemo(() => () => doSomething(id), [id]);
```

---

## ä¸ƒã€Hook çš„è°ƒç”¨è§„åˆ™ï¼ˆå¿…é¡»è®°ä½ï¼‰

1ï¸âƒ£ åªèƒ½åœ¨å‡½æ•°ç»„ä»¶æˆ–è‡ªå®šä¹‰ Hook ä¸­è°ƒç”¨ï¼›
2ï¸âƒ£ ä¸èƒ½æ”¾åœ¨ ifã€forã€æˆ–åµŒå¥—å‡½æ•°ä¸­ï¼›
3ï¸âƒ£ è°ƒç”¨é¡ºåºåœ¨æ¯æ¬¡æ¸²æŸ“ä¸­å¿…é¡»ä¸€è‡´ã€‚

---

## å…«ã€è‡ªå®šä¹‰ Hookï¼ˆé€»è¾‘å¤ç”¨ï¼‰

### âœ… å®šä¹‰
è‡ªå®šä¹‰ Hook æ˜¯ä¸€ä¸ªä»¥ `use` å¼€å¤´çš„å‡½æ•°ï¼Œå†…éƒ¨å¯ä»¥è°ƒç”¨å…¶ä»– Hookã€‚

```jsx
function useWindowSize() {
  const [size, setSize] = useState({ w: window.innerWidth, h: window.innerHeight });
  useEffect(() => {
    const onResize = () => setSize({ w: window.innerWidth, h: window.innerHeight });
    window.addEventListener('resize', onResize);
    return () => window.removeEventListener('resize', onResize);
  }, []);
  return size;
}
```

### âœ… ä½¿ç”¨
```jsx
function App() {
  const { w, h } = useWindowSize();
  return <p>çª—å£å°ºå¯¸ï¼š{w} Ã— {h}</p>;
}
```

---

## ä¹ã€å¸¸è§é¢è¯•é¢˜ä¸ç­”é¢˜æ€è·¯

### â“1. ä¸ºä»€ä¹ˆ Hook ä¸èƒ½æ”¾åœ¨æ¡ä»¶è¯­å¥ä¸­ï¼Ÿ
**ç­”é¢˜æ€è·¯ï¼š**
> React æ˜¯é€šè¿‡ Hook è°ƒç”¨é¡ºåºæ¥åŒ¹é…çŠ¶æ€çš„ã€‚
> å¦‚æœé¡ºåºå˜åŒ–ï¼ˆä¾‹å¦‚æŸæ¬¡è·³è¿‡ useStateï¼‰ï¼ŒReact ä¼šå–é”™çŠ¶æ€ã€‚

### â“2. setState æ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥çš„ï¼Ÿ
**ç­”é¢˜æ€è·¯ï¼š**
> React 18 ä¹‹å‰ï¼šäº‹ä»¶å†…æ˜¯å¼‚æ­¥ï¼ŒPromise ä¸­æ˜¯åŒæ­¥ã€‚
> React 18 ä¹‹åï¼šæ‰€æœ‰ä¸Šä¸‹æ–‡é»˜è®¤å¼‚æ­¥æ‰¹å¤„ç†ã€‚

### â“3. useEffect å’Œ useLayoutEffect çš„åŒºåˆ«ï¼Ÿ
**ç­”é¢˜æ€è·¯ï¼š**
> useEffect åœ¨æ¸²æŸ“åå¼‚æ­¥æ‰§è¡Œï¼Œä¸é˜»å¡ UIï¼›
> useLayoutEffect åœ¨æ¸²æŸ“ååŒæ­¥æ‰§è¡Œï¼Œç”¨äºè¯»å–æˆ–ä¿®æ”¹ DOMã€‚

### â“4. useMemo å’Œ useCallback çš„åŒºåˆ«ï¼Ÿ
**ç­”é¢˜æ€è·¯ï¼š**
| Hook | ç¼“å­˜å†…å®¹ | ç›®çš„ |
|------|-----------|------|
| useMemo | ç¼“å­˜è®¡ç®—ç»“æœ | é¿å…é‡å¤è®¡ç®— |
| useCallback | ç¼“å­˜å‡½æ•°å¼•ç”¨ | é¿å…å­ç»„ä»¶é‡å¤æ¸²æŸ“ |

---

## ğŸ”š å°ç»“

| Hook | æ ¸å¿ƒåŸç† | é¢è¯•å…³é”®è¯ |
|------|-----------|-------------|
| useState | Hook é“¾è¡¨å­˜çŠ¶æ€ | è°ƒç”¨é¡ºåº |
| useEffect | å‰¯ä½œç”¨å¼‚æ­¥æ‰§è¡Œ | Commit é˜¶æ®µ |
| useMemo | ç¼“å­˜ç»“æœ | æ€§èƒ½ä¼˜åŒ– |
| useCallback | ç¼“å­˜å‡½æ•° | å­ç»„ä»¶ä¼˜åŒ– |
| è‡ªå®šä¹‰ Hook | å°è£…å¤ç”¨é€»è¾‘ | å¯ç»´æŠ¤æ€§ |
